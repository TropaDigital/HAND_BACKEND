import JoiAdapter from '../../../adapters/joi/JoiAdapter';
import * as schemas from '../schemas';
import {
  makeFakeCreate{{pascalCase name}}Input,
  makeFakeUpdate{{pascalCase name}}Input,
} from './helpers/test-helper';

const makeSut = () => {
  const sut = new JoiAdapter(schemas);

  return { sut };
};

describe('Schema', () => {
  describe('Get{{pascalCase name}}ById', () => {
    it('should success when receive a valid input', () => {
      const { sut } = makeSut();
      const param = { id: 2 };

      const result = sut.validateSchema('Get{{pascalCase name}}ById', param);

      expect(result).toEqual(param);
    });

    it('should return error when an invalid input is provided', () => {
      const { sut } = makeSut();
      const param = { id: '' };

      expect(() => sut.validateSchema('Get{{pascalCase name}}ById', param)).toThrow(
        new Error('Missing or invalid param'),
      );
    });
  });

  describe('Create{{pascalCase name}}', () => {
    it('should success when receive a valid input', () => {
      const { sut } = makeSut();
      const param = makeFakeCreate{{pascalCase name}}Input();

      const result = sut.validateSchema('Create{{pascalCase name}}', param);

      expect(result).toEqual(param);
    });

    it('should throw when an invalid input is provided', () => {
      const { sut } = makeSut();
      const param = {
        name: 1,
        taxId: 2,
        city: 2,
        state: 1,
        commission: '10',
        createdBy: 2,
      };

      expect(() => sut.validateSchema('Create{{pascalCase name}}', param)).toThrow(
        new Error('Missing or invalid param'),
      );
    });
  });

  describe('Update{{pascalCase name}}ById', () => {
    it('should success when receive a valid input', () => {
      const { sut } = makeSut();
      const param = { id: 777, ...makeFakeUpdate{{pascalCase name}}Input() };

      const result = sut.validateSchema('Update{{pascalCase name}}ById', param);

      expect(result).toEqual(param);
    });

    it('should throw when an invalid input is provided', () => {
      const { sut } = makeSut();
      const param = {
        name: 1,
        taxId: 2,
        city: 2,
        state: 1,
        commission: '10',
        createdBy: 2,
      };

      expect(() => sut.validateSchema('Update{{pascalCase name}}ById', param)).toThrow(
        new Error('Missing or invalid param'),
      );
    });
  });

  describe('Delete{{pascalCase name}}ById', () => {
    it('should success when receive a valid input', () => {
      const { sut } = makeSut();
      const param = { id: 2 };

      const result = sut.validateSchema('Delete{{pascalCase name}}ById', param);

      expect(result).toEqual(param);
    });

    it('should return error when an invalid input is provided', () => {
      const { sut } = makeSut();
      const param = { id: '' };

      expect(() => sut.validateSchema('Delete{{pascalCase name}}ById', param)).toThrow(
        new Error('Missing or invalid param'),
      );
    });
  });
});
